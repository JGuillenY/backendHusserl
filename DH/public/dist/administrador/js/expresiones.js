var datalistContent="",modalOpcion="nuevo",todosTerminos=[],todasReferencias=[],newExpresion=()=>{$("#exampleModalLabel").html("Nueva Expresión"),modalOpcion="nuevo",$("#traduccionEditor").val(""),$("#expresionEditor").val(""),$("textarea#traduccionPEditor").ckeditor(),$("textarea#expresionPEditor").ckeditor(),$("#traduccionPEditor").val(""),$("#expresionPEditor").val(""),$("#traduccionIEditor").val("A"),$("#expresionIEditor").val("A"),document.getElementById("pills-home-tab").click(),$("#pills-profile-tab").hide(),$("#pills-home-tab").hide(),$("#expresionModalView").modal("show")},editExpresion=()=>{$("body").append("    <div id='loading-img' style='position:absolute;z-index: 3000; width:50px; top: calc(50vh - 25px); left: calc(50vw - 25px);'>        <img src='../images/Facebook-1s-200px.gif/>    </div>"),$("#exampleModalLabel").html("Editar Expresión"),modalOpcion="editar",$("textarea#traduccionPEditor").ckeditor(),$("input#traduccionEditor").val($$pasajeView.getState().expresionSeleccionada.expresion_es),$("textarea#expresionPEditor").ckeditor(),$("input#expresionEditor").val($$pasajeView.getState().expresionSeleccionada.expresion_de),$("#traduccionPEditor").val($$pasajeView.getState().expresionSeleccionada.pretty_es),$("#expresionPEditor").val($$pasajeView.getState().expresionSeleccionada.pretty_de),$("#traduccionIEditor").val($$pasajeView.getState().expresionSeleccionada.indice_es[0]),$("#expresionIEditor").val($$pasajeView.getState().expresionSeleccionada.indice_de[0]),$("#expresionModalView").modal("show"),$("#loading-img").hide(),document.getElementById("pills-home-tab").click()},editRelacion=()=>{$("body").append("    <div id='loading-img' style='position:absolute;z-index: 3000; width:50px; top: calc(50vh - 25px); left: calc(50vw - 25px);'>        <img src='../images/Facebook-1s-200px.gif/>    </div>"),fillLists(),$("#relacionModalView").modal("show"),$("#loading-img").hide()},deleteExpresion=()=>{var e=$$pasajeView.getState().expresionSeleccionada.id;confirm("¿Quiere eliminar la expresión seleccionada?")&&($$pasajeView.getState().hijos.length<1&&$$pasajeView.getState().padres.length<1?0==$$pasajeView.getState().lista_pasajes.length?adminService("/expresiones/deleteExpresion/"+e,"DELETE",{},e=>{$("#expresionModalView").modal("hide"),getPalabras(localStore.getObject("letter"))}):alert("La expresión contiene pasajes relacionados. Por favor, elimine dichas relaciones antes de proseguir."):alert("La expresión tiene parentesco con otras expresiones. Por favor, elimine dichas relaciones antes de proseguir."))},selectedRef="",selectRef=e=>{$("i.fa-check-square").addClass("fa-square"),$("i.fa-check-square").removeClass("fa-check-square"),selectedRef=e,$("#check"+e).removeClass("fa-square"),$("#check"+e).addClass("fa-check-square")},selectedExpresion={padre:"",hijo:""},selectExpresion=(e,a)=>{$("i.fa-check-square").addClass("fa-square"),$("i.fa-check-square").removeClass("fa-check-square"),selectedExpresion[a]=e,$("#check"+a+e).removeClass("fa-square"),$("#check"+a+e).addClass("fa-check-square")},getPalabras=e=>{var a="/expresiones/todas/"+e;$("div#expresiones").html('    <div id="loading">        <img src="images/Facebook-1s-200px.gif">    </div>    '),adminService(a,"GET",{},e=>{e.error?createAlert("Error: ",e.error):adminService("/referencias/lista","GET",{},a=>{if(a.error)createAlert("Error: ",a.error);else{for(var i in datalistContent="",a.response)datalistContent+="<li id='li"+a.response[i].ref_id+"' class='row'><a href='#' class='col-2' onclick='selectRef(\""+a.response[i].ref_id+"\")'><i class='far fa-square' id='check"+a.response[i].ref_id+"'></i></a><span class='col-10'>"+a.response[i].ref_id+" - "+a.response[i].ref_libro_de+" // "+a.response[i].ref_libro_es+"</span></li>";document.getElementById("referenciasList").innerHTML=datalistContent,todosTerminos=e.response,todasReferencias=a.response,$$alfabetoView.setState("expresiones",e.response),$$alfabetoView.selectExpresion(e.response[0]),selectRef(a.response[0].ref_id)}})})},toggleArrow=e=>{$(e).children("i").hasClass("fa-angle-down")?($(e).children("i").removeClass("fa-angle-down"),$(e).children("i").addClass("fa-angle-up")):($(e).children("i").removeClass("fa-angle-up"),$(e).children("i").addClass("fa-angle-down"))},$$menuView=$("#letras").view({state:{opciones:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},selectLetter:function(e){localStore.setObject("letter",e),$$alfabetoView.setState("opcionSeleccionada",e),getPalabras(e)}}),$$alfabetoView=$("div#alfabeto-view").view({state:{opcionSeleccionada:"",expresiones:[],expresionSeleccionada:{id:""}},selectExpresion:function(e){$$pasajeView.setState("expresionSeleccionada",e),adminService("/expresiones/al/abuelosList/"+e.id,"GET",{},a=>{$$pasajeView.setState("padres",a.response),$$padresModalView.setState("padres",a.response),adminService("/expresiones/al/hijosList/"+e.id,"GET",{},a=>{$$pasajeView.setState("hijos",a.response),$$hijosModalView.setState("hijos",a.response),adminService("/referencias/obtieneReferencias/"+e.id,"GET",{},e=>{console.log(e),$$pasajeView.setState("referencias",e.response),$(".pasaje-login").hide()})})})}}),$$pasajeView=$("div#pasaje-view").view({state:{lista_pasajes:[],pasaje_seleccionado:{},lang:"de",posicion_seleccionada:0,expresionSeleccionada:{},hijos:[],padres:[],referencias:[]},changeLang:function(){"de"==this.getState().lang?this.setState("lang","es"):this.setState("lang","de")},editarPasaje:function(e){$("#exampleModalLabel").html("Editar Expresión"),$("#pasajeModal").modal("show"),$("textarea#traduccionPEditor").ckeditor(),$("textarea#traduccionPEditor").val(e.pasaje_traduccion),$("textarea#expresionPEditor").ckeditor(),$("textarea#expresionPEditor").val(e.pasaje_original)},deletePasaje:function(e){if(confirm("¿Desea realmente eliminar la relación?")){var a="/referencias/quitarPasaje/"+e.refid+"/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"DELETE",{},e=>{var a="/referencias/obtieneReferencias/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{$$pasajeView.setState("referencias",e.response),$(".pasaje-login").hide()})})}}}),nuevaExpresion={expresion:"",traduccion:""},searchRelacionPadre=()=>{var e=$$padresModalView.getState().padres;for(var a in e)if(selectedExpresion.padre==e[a].padre)return!0;return!1},searchRelacionHijo=()=>{var e=$$hijosModalView.getState().hijos;for(var a in e)if(selectedExpresion.hijo.id==e[a].hijo)return!0;return!1},$$padresModalView=$("#padreView").view({state:{padres:[]},addPadre:function(){searchRelacionPadre()?alert("Esa relacion ya existe, no se pueden duplicar."):($("#padresSqr").hide(),$("#padres-loading").show(),service="/expresiones/agregarPadre/"+$$pasajeView.getState().expresionSeleccionada.id,adminService(service,"POST",JSON.stringify({padre:selectedExpresion.padre}),e=>{var a="/expresiones/al/abuelosList/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{$$pasajeView.setState("padres",e.response),$$padresModalView.setState("padres",e.response),fillLists(),$("#padresSqr").show(),$("#padres-loading").hide(),$(".pasaje-login").hide()})}))},deletePadre:function(e){if(confirm("¿Desea realmente eliminar la relación?")){$("#padresSqr").hide(),$("#padres-loading").show();var a="/expresiones/eliminarRelacion/"+e.id+"/"+e.padre;adminService(a,"DELETE",{},e=>{var a="/expresiones/al/abuelosList/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{$$pasajeView.setState("padres",e.response),$$padresModalView.setState("padres",e.response),fillLists(),$("#padresSqr").show(),$("#padres-loading").hide(),$(".pasaje-login").hide()})})}}}),$$hijosModalView=$("#parentescoM").view({state:{hijos:[]},addHijo:function(){searchRelacionHijo()?alert("Esa relacion ya existe, no se pueden duplicar."):($("#hijosSqr").hide(),$("#hijos-loading").show(),service="/expresiones/agregarHijo/"+$$pasajeView.getState().expresionSeleccionada.id,adminService(service,"POST",JSON.stringify({hijo:selectedExpresion.hijo.split(" // ")[0]}),e=>{var a="/expresiones/al/hijosList/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{$$pasajeView.setState("hijos",e.response),$$hijosModalView.setState("hijos",e.response),fillLists(),$("#hijosSqr").show(),$("#hijos-loading").hide(),$(".pasaje-login").hide()})}))},deleteHijo:function(e){if(confirm("¿Desea realmente eliminar la relación?")){$("#hijosSqr").hide(),$("#hijos-loading").show();var a="/expresiones/eliminarRelacion/"+e.hijo+"/"+e.id;adminService(a,"DELETE",{},e=>{var a="/expresiones/al/hijosList/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{console.log(e),$$pasajeView.setState("hijos",e.response),$$hijosModalView.setState("hijos",e.response),fillLists(),$("#hijosSqr").show(),$("#hijos-loading").hide(),$(".pasaje-login").hide()})})}}}),getRawContent=e=>e.indexOf("<p>")>-1?getRawContent(e.replace("<p>","")):e.indexOf("</p>")>-1?getRawContent(e.replace("</p>","")):e.indexOf("\\n")>-1?getRawContent(e.replace("\\n","")):e,$$basicoModalView=$("#basicM").view({state:{expresionesList:[]},guardarExpresion:function(e){e.preventDefault();var a={indice_es:$("#traduccionIEditor").val(),indice_de:$("#expresionIEditor").val(),pretty_es:""===$("textarea#traduccionPEditor").val()?$("#traduccionIEditor").val():$("textarea#traduccionPEditor").val(),pretty_de:""==$("textarea#expresionPEditor").val()?$("#expresionIEditor").val():$("textarea#expresionPEditor").val(),expresion:$("#expresionEditor").val(),traduccion:$("#traduccionEditor").val()},i="/expresiones/";i+="editar"==modalOpcion?"updateExpresion/"+$$pasajeView.getState().expresionSeleccionada.id:"nuevaExpresion",adminService(i,"POST",JSON.stringify(a),e=>{localStore.getObject("letter"),$("#expresionModalView").modal("hide"),getPalabras(localStore.getObject("letter"))})}}),nuevoPasaje=()=>{$("#pasajeModal").modal("show")},searchPasajeIn=e=>{var a=$$pasajeView.getState("referencias");for(var i in a)if(a[i].refid==e)return!0;return!1},$$pasajeModalView=$("#pasajeModalView").view({state:{title:"Agregar Pasaje",opcion:"",hijos:[],padres:[]},asociarReferencia:function(e){e.preventDefault();var a={termId:$$pasajeView.getState().expresionSeleccionada.id,orden:parseInt(this.data.orden),referencia:selectedRef};searchPasajeIn(selectedRef)?alert("Esa relacion ya existe, no puede duplicarse."):adminService("/referencias/agregarReferencia","POST",JSON.stringify(a),e=>{alert("Se ha asociado exitosamente!");var a="/referencias/obtieneReferencias/"+$$pasajeView.getState().expresionSeleccionada.id;adminService(a,"GET",{},e=>{$$pasajeView.setState("referencias",e.response),$(".pasaje-login").hide()})})}}),expresionesList=[],fillLists=()=>{var e="",a="";for(var i in expresionesList)e+="<li style='width: 100%;' id='Pli"+expresionesList[i].t_id+"' class='row'><a href='#' class='col-2' onclick='selectExpresion(\""+expresionesList[i].t_id+"\", \"padre\")'><i class='far fa-square' id='checkpadre"+expresionesList[i].t_id+"'></i></a><span class='col-10'>"+expresionesList[i].t_id+" - "+expresionesList[i].t_term_de+" // "+expresionesList[i].t_term_es+"</span></li>";for(var i in expresionesList)a+="<li style='width: 100%;' id='Hli"+expresionesList[i].t_id+"' class='row'><a href='#' class='col-2' onclick='selectExpresion(\""+expresionesList[i].t_id+"\", \"hijo\")'><i class='far fa-square' id='checkhijo"+expresionesList[i].t_id+"'></i></a><span class='col-10'>"+expresionesList[i].t_id+" - "+expresionesList[i].t_term_de+" // "+expresionesList[i].t_term_es+"</span></li>";document.getElementById("expresionesListH").innerHTML=a,document.getElementById("expresionesListP").innerHTML=e},getAllList=()=>{adminService("/expresiones/getAllList","GET",{},e=>{expresionesList=e.response})};getPalabras("A"),getAllList();var selectPasaje=e=>{$$pasajeView.setState("posicion_seleccionada",e),$$pasajeView.setState("pasaje_seleccionado",$$pasajeView.getState().lista_pasajes[e]),document.getElementById("pasaje-orig").innerHTML=$$pasajeView.getState().lista_pasajes[e].pasaje_original,document.getElementById("pasaje-trad").innerHTML=$$pasajeView.getState().lista_pasajes[e].pasaje_traduccion},aplicaBusqueda=()=>{var e=$("#busqueda").val();for(var a in $(".hidden").removeClass("hidden"),todosTerminos){(todosTerminos[a].expresion_de+" "+todosTerminos[a].expresion_es).includes(e)||$("#heading"+todosTerminos[a].id).addClass("hidden")}$(".jerarq").tooltip()},aplicaBusquedaRef=()=>{var e=$("#busquedaR").val();for(var a in $("li.hidden").removeClass("hidden"),todasReferencias){(todasReferencias[a].ref_id+" "+todasReferencias[a].ref_libro_de+" "+todasReferencias[a].ref_libro_es).includes(e)||$("#li"+todasReferencias[a].ref_id).addClass("hidden")}},aplicaBusquedaE=(e,a)=>{var i=$("#busqueda"+a).val();if(13==e.keyCode||""==i){for(var s in $("ul#expresionesList"+a).hide(),$("div#"+a+"-loading-2").show(),$("li.hidden").removeClass("hidden"),expresionesList){(expresionesList[s].t_id+" "+expresionesList[s].t_term_de+" "+expresionesList[s].t_term_es).includes(i)||$("#"+a+"li"+expresionesList[s].t_id).addClass("hidden")}$("ul#expresionesList"+a).show(),$("div#"+a+"-loading-2").hide()}};$("document").ready(function(){$("#main-content").show()});